### HTTP & SSL & TLS

![image](https://user-images.githubusercontent.com/76515226/141709237-bceb32e9-6612-46de-aecc-54ff3fec62d2.png)

- HTTPS: SSL 프로토콜 위에서 돌아가는 프로토콜
- SSL: Secure Sockets Layer: 암호화 기반 인터넷 보안 프로토콜
- TSL: Transport Layer Security: IETF에 의해 SSL에서 이름이 바뀐 것
- 정식 명칭은 TSL이지만 SSL이라는 이름이 훨씬 많이 사용된다

### SSL 디지털 인증서

클라이언트와 서버간의 통신을 제3자가 보증해주는 전자화된 문서

- 통신 내용이 공격자에게 노출되는 것을 막을 수 있다
- 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서버인지 판단할 수 있다
- 통신 내용의 악의적인 변경을 방지할 수 있다

**대칭키**: 암호화를 할 때 사용한 키로 복호화를 할 수 있는 방식의 암호화 기법

- 암호를 주고받는 사람들 사이에 대칭키를 전달하는 과정에서 유출될 경우 매우 위험하다

**공개키**: 두개의 키로 암호화 및 복호화 하는 방식, A키로 암호화를 하면 B로 복호화를 할 수 있다

- 두개의 키 중 하나를 비공개키(개인키, 비밀키)라고 하고, 하나는 공개키로 지정한다
- 공캐기로 정보를 암호화 하고 전송받은 사람은 본인이 가지고있는 비공개키로 복호화를 한다
- 전송 과정에서 공개키가 유출되더라도 비공개키를 모르면 정보를 복호화할 수 없기 때문에 안전하다

**SSL 인증서의 역할**

1. 클라이언트가 접속한 서버가 신뢰할 수 있는 서버임을 보장한다
2. SSL 통신에 사용할 공개키를 클라이언트에 제공한다

**CA (Certificate Authority)**

- 인증서는 클라이언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지를 보장하는 역할을 한다
- 이러한 역할을 하는 기업들을 CA 혹은 Root Certificate라고 부른다
- Symantec, Comodo, GoDaddy, GlobalSign 등이 있다

SSL을 통해서 암호화된 통신을 제공하려는 서비스는 CA를 통해서 인증서를 구입해야 한다. BUT, 개발이나 사적인 목적을 위해서 SSL의 암호화 기능을 이용하려한다면 자신이 직접 CA의 역할을 할 수도 있다

**SSL 인증서의 내용**

SSL 인증서에는 다음과 같은 정보가 포함되어 있다

1. 서비스의 정보 (인증서를 발급한 CA, 서비스의 도메인 등등)
2. 서버 측 공개키 (공개키의 내용, 공개키의 암호화 방법)

**SSL의 동작방법**

SSL은 암호화된 데이터를 전송하기 위해서 공개키와 대칭키를 혼합해서 사용한다. 클라이언트와 서버가 주고 받는 실제 정보는 대칭키 방식으로 암호화하고, 대칭키 방식으로 암호화된 실제 정보를 복호화할 때사용할 대칭키는 공개키 방식으로 암호화해서 클라이언트와 서버가 주고 받는다

- 실제 데이터 : 대칭키
- 대칭키의 키 : 공개키

컴퓨터끼리 네트워크를 이용해서 통신할 때는 내부적으로 3단계를 거치게 된다, 악수 -> 전송 -> 세션종료

1. 악수(Handshake)

   1. 클라이언트가 서버에 접속한다 - Client Hello
      - 클라이언트 측에서 생성한 랜덤 데이터를 주고받는다

   2. 서버는 Client Hello에 대한 응답으로 Server Hello를 한다
      - 서버 측에서 생성한 랜덤 데이터, 암호화 방식, 인증서를 주고받는다

   3. 서버의 인증서가 CA에 의해서 발급된 것인지 확인을 위하여 클라이언트에 내장된 CA 리스트를 확인한다
      - 클라이언트와 서버측의 랙덤 데이터를 조합해 pre master secret 키를 생성한다, 서버의 공개키를 이용해서 해당 값을 암호화한 후 서버에 전송한다
   4. 서버는 클라이언트가 전송한 pre master secret 값을 자신의 비공개키로 복호화 한다
      - 서버와 클라이언트 모두 pre master secret 값을 master secret으로 바꾼 후 session key를 생성하여 데이터를 대칭키 방식으로 암호화한 후 주고받는다
   5. 클라이언트와 서버는 핸드쉐이크 단계의 종료를 서로에게 알린다

2. 세션

   - 실제로 서버와 클라이언트가 데이터를 주고받는 단계, 정보를 전송하기 전에 session key 값을 이용해서 대칭키 방식으로 암호화 한다
   - 공개키 방식은 자원을 많이 소모하는데 많은 접속이 몰리는 서버는 매우 큰 비용이 생기게 된다, 하지만 암호화가 되지 않은 인터넷을 통해서 대칭키를 전송하는 것 또한 위험하다. 
   - 그래서 속도는 느리지만 데이터를 안전하게 주고 받을 수 있는 공개키 방식으로 대칭키를 암호화하고, 실제 데이터를 주고 받을 때는 대칭키를 이용해서 데이터를 주고 받는다

3. 세션종료

   - 데이터의 전송이 끝나면 SSL 통신이 끝났음을 서로에게 알려준다. 이 때 통신에서 사용한 대칭키인 세션키를 폐기한다